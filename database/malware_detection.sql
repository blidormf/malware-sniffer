DROP DATABASE malware_detection;

CREATE DATABASE IF NOT EXISTS malware_detection;

USE malware_detection;

DROP TABLE IF EXISTS file_info;

CREATE TABLE file_info (
    file_hash CHAR(64) PRIMARY KEY,
    is_malicious BOOLEAN NOT NULL,
    name VARCHAR(255),
	first_seen TIMESTAMP NOT NULL,
    size BIGINT NOT NULL
);

DROP TABLE IF EXISTS  link_info;

CREATE TABLE link_info (
    link_hash CHAR(64) PRIMARY KEY,
    is_malicious BOOLEAN NOT NULL,
    url VARCHAR(255),
	first_seen TIMESTAMP NOT NULL
);

DROP TABLE IF EXISTS user;

CREATE TABLE user (
username VARCHAR(39) PRIMARY KEY
);

DROP TABLE IF EXISTS comment;

CREATE TABLE comment (
	id BIGINT PRIMARY KEY AUTO_INCREMENT,
    content TEXT NOT NULL,
    created_at TIMESTAMP NOT NULL,
    user VARCHAR(39) NOT NULL,
    file_hash CHAR(64),
    link_hash CHAR(64),
    FOREIGN KEY (user) REFERENCES user(username),
    FOREIGN KEY (file_hash) REFERENCES file_info(file_hash),
    FOREIGN KEY (link_hash) REFERENCES link_info(link_hash),
    CHECK (
		(file_hash IS NOT NULL AND link_hash IS NULL) OR
        (file_hash IS NULL AND link_hash IS NOT NULL)
        )
	);